!function(e){if("function"==typeof bootstrap)bootstrap("immutable",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeImmutable=e}else"undefined"!=typeof window?window.immutable=e():global.immutable=e()}(function(){var define,ses,bootstrap,module,exports;return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){"use strict";module.exports={object:require("./object"),obj:require("./object"),array:require("./array"),arr:require("./array")}},{"./object":2,"./array":3}],4:[function(require,module,exports){"use strict";var extend=function(t,f){for(var p in f)t[p]=f[p];return t};var clone=function(o){return extend({},o)};var slice=function(a,f,n){return[].slice.call(a,f,n)};var mapObj=function(o,fn){var r={};for(var p in o)r[p]=fn(o[p],p,o);return r};var pick=function(o){var names=slice(arguments,1);var r={};for(var i=0;i<names.length;i+=1)r[names[i]]=o[names[i]];return r};var freeze=Object.freeze||function(o){return o};var areEqual=function(v1,v2){if(v1&&typeof v1.equal=="function"&&v1.immutable)return v1.equal(v2);else return v1===v2};module.exports={extend:extend,clone:clone,slice:slice,mapObj:mapObj,pick:pick,freeze:freeze,areEqual:areEqual}},{}],2:[function(require,module,exports){"use strict";var p=require("persistent-hash-trie");var util=require("./util");module.exports=function(attrs){return(new object).assoc(attrs)};var assocMultiple=function(obj,attrs){for(var p in attrs)if(attrs.hasOwnProperty(p))obj=obj.assoc(p,attrs[p]);return obj};var assocOne=function(trie,key,value){return new object(p.assoc(trie,key.toString(),value))};var object=function(trie){trie=trie||p.Trie();this.assoc=function(arg1,arg2){if(arguments.length===1)return assocMultiple(this,arg1);else return assocOne(trie,arg1,arg2)};this.dissoc=function(key){return new object(p.dissoc(trie,key.toString()))};this.get=function(key){return p.get(trie,key.toString())};this.has=function(key){return p.has(trie,key.toString())};this.mutable=this.toJSON=function(){return p.mutable(trie)};var separateSeed=function(o){var keyVal=p.reduce(trie,function(seed,val,key){return p.reduce.Break({key:key,val:val})});return{seed:keyVal.val,rest:o.dissoc(keyVal.key)}};this.reduce=function(fn,seed){var orig=this;if(arguments.length===1){var seedAndRest=separateSeed(this);seed=seedAndRest.seed;return seedAndRest.rest.reduce(fn,seed)}return p.reduce(trie,function(seed,val,key){return fn(seed,val,key,orig)},seed)};this.immutable=true;util.freeze(this)};module.exports.prototype=object.prototype={constructor:module.exports,map:function(fn){var orig=this;return this.reduce(function(o,val,key){return o.assoc(key,fn(val,key,orig))},orig)},forEach:function(fn){var orig=this;return this.reduce(function(o,val,key){fn(val,key,orig)},undefined)},every:function(predicate){var orig=this;return this.reduce(function(o,val,key){if(predicate(val,key,orig)===true)return true;else return new p.reduce.Break(false)},true)},some:function(predicate){var orig=this;return this.reduce(function(o,val,key){if(predicate(val,key,orig)===true)return new p.reduce.Break(true);else return false},false)},filter:function(predicate){var orig=this;return this.reduce(function(o,val,key){if(predicate(val,key,orig)===true)return o.assoc(key,val);else return o},new object)},equal:function(val1){var val2=this;if(val1===val2)return true;if(!val1||!val1.immutable)return false;var equal1=val1.every(function(v,k){return util.areEqual(v,val2.get(k))});var equal2=val2.every(function(v,k){return util.areEqual(v,val1.get(k))});return equal1&&equal2}}},{"./util":4,"persistent-hash-trie":5}],3:[function(require,module,exports){"use strict";var p=require("persistent-hash-trie");var util=require("./util");var object=require("./object");module.exports=function(attrs){return(new array).assoc(attrs)};var assocMultiple=function(arr,attrs){for(var p in attrs)if(attrs.hasOwnProperty(p))arr=arr.assoc(p,attrs[p]);return arr};var assocOne=function(arr,trie,key,value){var keyAsLength=parseInt(key,10)+1;var length=Math.max(arr.length,keyAsLength||0);var newTrie=p.assoc(trie,key.toString(),value);return new array(newTrie,length)};var array=function(trie,length){trie=trie||p.Trie();this.length=length||0;this.assoc=function(arg1,arg2){if(arguments.length===1)return assocMultiple(this,arg1);else return assocOne(this,trie,arg1,arg2)};this.dissoc=function(key){var newTrie=p.dissoc(trie,key.toString());return new array(newTrie,this.length)};this.get=function(key){return p.get(trie,key.toString())};this.has=function(key){return p.has(trie,key.toString())};this.mutable=this.toJSON=function(){return util.extend([],p.mutable(trie))};this.immutable=true;util.freeze(this)};var firstMember=function(a){for(var i=0,len=a.length;i<len;i+=1)if(a.has(i))return i};var lastMember=function(a){for(var i=a.length-1;i>=0;i-=1)if(a.has(i))return i};module.exports.prototype=array.prototype={constructor:module.exports,map:function(fn){var result=this;for(var i=0,len=this.length;i<len;i+=1){if(this.has(i))result=result.assoc(i,fn(this.get(i),i,this))}return result},forEach:function(fn){for(var i=0,len=this.length;i<len;i+=1){if(this.has(i))fn(this.get(i),i.toString(),this)}},every:function(predicate){for(var i=0,len=this.length;i<len;i+=1){if(this.has(i)){if(predicate(this.get(i),i.toString(),this)!==true)return false}}return true},some:function(predicate){for(var i=0,len=this.length;i<len;i+=1){if(this.has(i)){if(predicate(this.get(i),i.toString(),this)===true)return true}}return false},filter:function(predicate){var result=new array;for(var i=0,len=this.length;i<len;i+=1){if(this.has(i)){if(predicate(this.get(i),i.toString(),this)===true)result=result.assoc(result.length,this.get(i))}}return result},reduce:function(fn,seed){if(arguments.length===1){var member=firstMember(this);return this.dissoc(member).reduce(fn,this.get(member))}for(var i=0,len=this.length;i<len;i+=1){if(this.has(i))seed=fn(seed,this.get(i),i.toString(),this)}return seed},reduceRight:function(fn,seed){if(arguments.length===1){var member=lastMember(this);return this.dissoc(member).reduceRight(fn,this.get(member))}for(var i=this.length-1;i>=0;i-=1){if(this.has(i))seed=fn(seed,this.get(i),i.toString(),this)}return seed},push:function(v){return this.assoc(this.length,v)},indexOf:function(v){for(var i=0,len=this.length;i<len;i+=1){if(this.has(i)&&util.areEqual(v,this.get(i)))return i}return-1},equal:object.prototype.equal}},{"./util":4,"./object":2,"persistent-hash-trie":5}],5:[function(require,module,exports){"use strict";var util=require("./util");var hash=require("./hash");var lib=module.exports;var defaultOpts={eq:function(a,b){return a===b},hash:hash.hash};var Trie=lib.Trie=function(children){return{type:"trie",children:children||{}}};var Value=lib.Value=function(key,value){return{type:"value",key:key,value:value}};var Hashmap=lib.Hashmap=function(values){return{type:"hashmap",values:values}};var copyAdd=function(obj,key,val){obj=util.clone(obj);obj[key]=val;return obj};lib.assoc=function(node,key,val,opts){return assoc(node,key,val,opts||defaultOpts,0)};var assoc=function(node,key,val,opts,depth){return assocFns[node.type](node,key,val,opts,depth)};var assocFns={trie:function(node,key,val,opts,depth){var path=hash.mask(key,depth,opts.hash);var child=node.children[path];if(child===undefined)return Trie(copyAdd(node.children,path,Value(key,val)));else return Trie(copyAdd(node.children,path,assoc(child,key,val,opts,depth+1)))},value:function(node,key,val,opts,depth){var nodePath=hash.mask(node.key,depth,opts.hash);var keyPath=hash.mask(key,depth,opts.hash);var makeHashmap=function(){var children={};children[key]=Value(key,val);children[node.key]=node;return Hashmap(children)};var resolveShallowConflict=function(){var children={};children[nodePath]=node;children[keyPath]=Value(key,val);return Trie(children)};var resolveDeepConflict=function(){var children={};children[keyPath]=assoc(node,key,val,opts,depth+1);return Trie(children)};var makeTrie=function(){if(nodePath!==keyPath)return resolveShallowConflict();else return resolveDeepConflict()};if(opts.eq(node.key,key))return Value(key,val);else if(depth>6)return makeHashmap();else return makeTrie()},hashmap:function(node,key,val,opts,depth){var v=copyAdd(node.values,key,Value(key,val));return Hashmap(v)}};var copyDissoc=function(obj,key){obj=util.clone(obj);delete obj[key];return obj};lib.dissoc=function(node,key,opts){return dissoc(node,key,opts||defaultOpts,0)};var dissoc=function(node,key,opts,depth){return dissocFns[node.type](node,key,opts,depth)};var dissocFns={trie:function(node,key,opts,depth){var path=hash.mask(key,depth,opts.hash);var child=node.children[path];var dissocKey=function(){if(child.type==="value"&&opts.eq(child.key,key))return Trie(copyDissoc(node.children,path));else return Trie(copyDissoc(node.children,path,dissoc(child,key,opts,depth+1)))};var collapseTrie=function(trie){var names=util.keys(trie.children);var child=trie.children[names[0]];if(depth===0)return trie;else if(child===undefined)return trie;else if(names.length===1&&child.type==="value")return Value(child.key,child.value);else return trie};var handleTrie=function(){return collapseTrie(dissocKey(node))};if(child===undefined)return node;else return handleTrie()},value:function(){},hashmap:function(node,key,opts,depth){var ret=copyDissoc(node.values,key);var names=util.keys(ret);var child=ret[names[0]];if(names.length===1)return Value(child.key,child.value);else return Hashmap(ret)}};lib.has=function(trie,key,opts){return has(trie,key,opts||defaultOpts,0)};var has=function(trie,key,opts,depth){return hasFns[trie.type](trie,key,opts,depth)};var hasFns={trie:function(node,key,opts,depth){var child=node.children[hash.mask(key,depth,opts.hash)];if(child===undefined)return false;else return has(child,key,opts,depth+1)},value:function(node,key,opts){return opts.eq(node.key,key)},hashmap:function(node,key,opts){return key in node.values}};lib.get=function(trie,key,opts){return get(trie,key,opts||defaultOpts,0)};var get=function(trie,key,opts,depth){return getFns[trie.type](trie,key,opts,depth)};var getFns={trie:function(node,key,opts,depth){var child=node.children[hash.mask(key,depth,opts.hash)];if(child===undefined)return undefined;else return get(child,key,opts,depth+1)},value:function(node,key,opts,depth){if(opts.eq(node.key,key))return node.value},hashmap:function(node,key,opts,depth){var value=node.values[key];return value?value.value:undefined}};lib.reduce=function(node,callback,initial){var state=reduce(node,callback,initial);return state instanceof Break?state.value:state};var reduce=function(node,callback,initial){return reduceFns[node.type](node,callback,initial)};var reduceFns={trie:function(node,callback,state){for(var path in node.children){if(node.children.hasOwnProperty(path)){state=reduce(node.children[path],callback,state)}if(state instanceof Break)break}return state},value:function(node,callback,state){return callback(state,node.value,node.key)},hashmap:function(node,callback,state){for(var key in node.values){if(node.values.hasOwnProperty(key)){state=reduce(node.values[key],callback,state)}if(state instanceof Break)break}return state}};var Break=lib.reduce.Break=function(v){if(!(this instanceof Break))return new Break(v);this.value=v};lib.mutable=function(node){return lib.reduce(node,addKeyVal,{})};var addKeyVal=function(o,val,key){o[key]=val;return o};lib.keys=function(node){return lib.reduce(node,addKey,[])};var addKey=function(arr,val,key){arr.push(key);return arr}},{"./util":6,"./hash":7}],6:[function(require,module,exports){"use strict";var extend=function(t,f){for(var p in f)t[p]=f[p];return t};var clone=function(o){return extend({},o)};var slice=function(a,f,n){return[].slice.call(a,f,n)};var mapObj=function(o,fn){var r={};for(var p in o)r[p]=fn(o[p],p,o);return r};var map=function(arr,fn){var a=[];for(var i=0,l=arr.length;i<l;i+=1)a.push(fn(arr[i],i,arr));return a};var reduce=function(arr,fn){var seed=arr[0];arr=arr.slice(1);for(var i=0,l=arr.length;i<l;i+=1)seed=fn(seed,arr[i]);return seed};var pick=function(o){var names=slice(arguments,1),r={};for(var i=0,l=names.length;i<l;i+=1)r[names[i]]=o[names[i]];return r};var keys=Object.keys||function(o){var a=[];for(var key in o)a.push(key);return a};module.exports={extend:extend,clone:clone,slice:slice,mapObj:mapObj,pick:pick,map:map,reduce:reduce,keys:keys}},{}],7:[function(require,module,exports){var mask=function(hash,from){return hash>>>from&31};var hashMask=function(str,from,hash){return mask(hash(str),from)};module.exports={hash:require("string-hash"),mask:hashMask}},{"string-hash":8}],8:[function(require,module,exports){module.exports=function(str){var hash=5381,i=str.length;while(i)hash=hash*33^str.charCodeAt(--i);return hash>=0?hash:(hash&2147483647)+2147483648}},{}]},{},[1])(1)});
